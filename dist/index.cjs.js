/*! For license information please see index.cjs.js.LICENSE.txt */
(()=>{"use strict";var t={488:(t,e,r)=>{r.r(e),r.d(e,{ZarrTile:()=>g,default:()=>x});const n=require("ol/source/DataTile");var a=r.n(n);const i=require("ol/tilegrid/TileGrid");var o=r.n(i);const s=require("zarr");function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function i(r,n,a,i){var u=n&&n.prototype instanceof s?n:s,c=Object.create(u.prototype);return l(c,"_invoke",function(r,n,a){var i,s,u,c=0,l=a||[],m=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,r){return i=e,s=0,u=t,d.n=r,o}};function f(r,n){for(s=r,u=n,e=0;!m&&c&&!a&&e<l.length;e++){var a,i=l[e],f=d.p,h=i[2];r>3?(a=h===n)&&(u=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=t):i[0]<=f&&((a=r<2&&f<i[1])?(s=0,d.v=n,d.n=i[1]):f<h&&(a=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,s=0))}if(a||r>1)return o;throw m=!0,n}return function(a,l,h){if(c>1)throw TypeError("Generator is already running");for(m&&1===l&&f(l,h),s=l,u=h;(e=s<2?t:u)||!m;){i||(s?s<3?(s>1&&(d.n=-1),f(s,u)):d.n=u:d.v=u);try{if(c=2,i){if(s||(a="next"),e=i[a]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(u=TypeError("The iterator does not provide a '"+a+"' method"),s=1);i=t}else if((e=(m=d.n<0)?u:r.call(n,d))!==o)break}catch(e){i=t,s=1,u=e}finally{c=1}}return{value:e,done:m}}}(r,a,i),!0),c}var o={};function s(){}function u(){}function m(){}e=Object.getPrototypeOf;var d=[][n]?e(e([][n]())):(l(e={},n,function(){return this}),e),f=m.prototype=s.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,a,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=m,l(f,"constructor",m),l(m,"constructor",u),u.displayName="GeneratorFunction",l(m,a,"GeneratorFunction"),l(f),l(f,a,"Generator"),l(f,n,function(){return this}),l(f,"toString",function(){return"[object Generator]"}),(c=function(){return{w:i,m:h}})()}function l(t,e,r,n){var a=Object.defineProperty;try{a({},"",{})}catch(t){a=0}l=function(t,e,r,n){function i(e,r){l(t,e,function(t){return this._invoke(e,r,t)})}e?a?a(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},l(t,e,r,n)}function m(t,e,r,n,a,i,o){try{var s=t[i](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,a)}function d(t){return function(){var e=this,r=arguments;return new Promise(function(n,a){var i=t.apply(e,r);function o(t){m(i,n,a,o,s,"next",t)}function s(t){m(i,n,a,o,s,"throw",t)}o(void 0)})}}function f(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function p(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,y(n.key),n)}}function y(t){var e=function(t){if("object"!=u(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=u(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==u(e)?e:e+""}function v(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(v=function(){return!!t})()}function _(t){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_(t)}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}const g=function(t){function e(t){var r;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),null==t||!t.metadata)throw new Error("Metadata is required for ZarrTile source");if(!t.metadata.url)throw new Error("URL is required in ZarrTile metadata");var n=t.metadata,a=n.extent,i=n.zoomLevels,s=n.resolutions,l=n.crs,m=n.bandIndices,h=n.currentTime,p=n.nodata,y=n.path,b=void 0===y?"":y,g=n.arrayPaths,x=void 0===g?{value:"value",time:"time",statistics:"statistics"}:g;if(!(a&&i&&s&&l))throw new Error("Missing required metadata: extent, zoomLevels, resolutions, and crs are required");var T,w=e._generateFullArrays(s,i),I=new(o())({extent:a,resolutions:w,minZoom:Math.min.apply(Math,f(i)),maxZoom:Math.max.apply(Math,f(i))});return r=function(t,e,r){return e=_(e),function(t,e){if(e&&("object"==u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,v()?Reflect.construct(e,r||[],_(t).constructor):e.apply(t,r))}(this,e,[{projection:l,tileGrid:I,interpolate:void 0===t.interpolate||t.interpolate,transition:t.transition||0,wrapX:void 0!==t.wrapX&&t.wrapX,loader:(T=d(c().m(function t(e,n,a){return c().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,r.tileLoader(e,n,a);case 1:return t.a(2,t.v)}},t)})),function(t,e,r){return T.apply(this,arguments)})}]),r.url_=r._normalizeUrl(t.metadata.url),r.path_=b,r.arrayPaths_=x,r.metadata_=t.metadata,r.bandIndices_=m||[0],r.bandIndex_=t.bandIndex||0,r.timestamps_=t.metadata.timestamps||[],r.statistics_=t.metadata.statistics||[],r.nodata_=p,r.usePercentiles_=void 0===t.metadata.usePercentiles||t.metadata.usePercentiles,r.currentTimeIndex_=0,h&&r.timestamps_.length>0?r.currentTimeIndex_=r._findClosestTimestampIndex(h):void 0!==t.timeIndex&&(r.currentTimeIndex_=Math.max(0,Math.min(t.timeIndex,r.timestamps_.length-1))),r.addChangeListener("time",function(){return r.refresh()}),r.addChangeListener("bands",function(){return r.refresh()}),r.timestamps_.length>0&&r.set("time",r.timestamps_[r.currentTimeIndex_]),r.set("bands",r.bandIndices_),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(e,t),n=e,a=[{key:"_normalizeUrl",value:function(t){return t.replace(/\/+$/,"")}},{key:"getZoomUrl",value:function(t){return"".concat(this.url_,"/").concat(this.path_,"/").concat(t).replace(/\/+/g,"/")}},{key:"getValueArrayUrl",value:function(t){return"".concat(this.getZoomUrl(t),"/").concat(this.arrayPaths_.value)}},{key:"isZoomSupported",value:function(t){return this.metadata_.zoomLevels.includes(t)}},{key:"tileLoader",value:(h=d(c().m(function t(e,n,a){var i,o,s,u=this;return c().w(function(t){for(;;)switch(t.n){case 0:if(this.isZoomSupported(e)){t.n=1;break}return t.a(2,void 0);case 1:return i=this.getTileGrid(),o=i.getTileSize(e),s=i.getFullTileRange(e),t.a(2,new Promise(function(t,i){var c;try{c=new URL("zarr-worker.js",r.p)}catch(t){c="zarr-worker.js"}var l=new Worker(c,{type:"module"});l.onmessage=function(e){l.terminate(),e.data.error?i(new Error(e.data.error)):t(e.data.tileData)},l.onerror=function(t){l.terminate(),i(t)},l.postMessage({z:e,x:n,y:a,tileSize:o,tileRange:s,bands:u.bandIndices_,bandIndex:u.bandIndex_,timeIndex:u.currentTimeIndex_,nodata:u.nodata_,normalize:u.metadata_.normalize||!1,statistics:u.getCurrentStatistics(),usePercentiles:u.usePercentiles_,storeUrl:u.url_,storePath:u.getValueArrayUrl(e)})}))}},t,this)})),function(t,e,r){return h.apply(this,arguments)})},{key:"retrieveTimestamps",value:(m=d(c().m(function t(){var e,r,n,a;return c().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!(this.timestamps_.length>0)){t.n=1;break}return t.a(2);case 1:return e=[],t.p=2,r=Math.max.apply(Math,f(this.metadata_.zoomLevels)),t.n=3,(0,s.openArray)({store:this.url_,path:"".concat(this.path_,"/").concat(r,"/").concat(this.arrayPaths_.time).replace(/\/+/g,"/"),mode:"r"});case 3:return n=t.v,t.n=4,n.get([null]);case 4:t.v.data.forEach(function(t){e.push(new Date(1e3*t))}),this.timestamps_=e,e.length>0&&this.currentTimeIndex_>=e.length&&(this.currentTimeIndex_=e.length-1),t.n=6;break;case 5:t.p=5,a=t.v,console.warn("Could not retrieve timestamps:",a.message);case 6:return t.a(2)}},t,this,[[2,5]])})),function(){return m.apply(this,arguments)})},{key:"retrieveStatistics",value:(l=d(c().m(function t(){var e,r,n,a;return c().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!(this.statistics_.length>0)){t.n=1;break}return t.a(2);case 1:return e=[],t.p=2,r=Math.max.apply(Math,f(this.metadata_.zoomLevels)),t.n=3,(0,s.openArray)({store:this.url_,path:"".concat(this.path_,"/").concat(r,"/").concat(this.arrayPaths_.statistics).replace(/\/+/g,"/"),mode:"r"});case 3:return n=t.v,t.n=4,n.get([null,this.bandIndex_,null]);case 4:t.v.data.forEach(function(t){e.push({min:t[0],max:t[1],mean:t[2],p2:t[3],p98:t[4],mode:t[5],std:t[6]})}),this.statistics_=e,t.n=6;break;case 5:t.p=5,a=t.v,console.warn("Could not retrieve statistics:",a.message);case 6:return t.a(2)}},t,this,[[2,5]])})),function(){return l.apply(this,arguments)})},{key:"getCurrentStatistics",value:function(){if(0===this.statistics_.length)return null;var t=Math.min(this.currentTimeIndex_,this.statistics_.length-1);return this.statistics_[t]}},{key:"_findClosestTimestampIndex",value:function(t){if(0===this.timestamps_.length)return 0;for(var e=0,r=Math.abs(this.timestamps_[0].getTime()-t.getTime()),n=1;n<this.timestamps_.length;n++){var a=Math.abs(this.timestamps_[n].getTime()-t.getTime());a<r&&(r=a,e=n)}return e}},{key:"getTimeRangeIndices",value:function(t,e){for(var r=t.getTime(),n=e.getTime(),a=-1,i=-1,o=0;o<this.timestamps_.length;o++){var s=this.timestamps_[o].getTime();if(-1===a&&s>=r&&(a=o),s>n){i=o-1;break}s<=n&&(i=o)}return{startIndex:-1===a?0:a,endIndex:-1===i?this.timestamps_.length-1:i}}},{key:"getIndicesFromCoord",value:function(t){var e=this.metadata_.resolutions[this.metadata_.resolutions.length-1],r=this.metadata_.extent,n=Math.max(r[0],Math.min(t[0],r[2])),a=Math.max(r[1],Math.min(t[1],r[3]));return[Math.floor((n-r[0])/e),Math.floor((r[3]-a)/e)]}},{key:"getCoordinateAtIndex",value:function(t,e){var r=this.metadata_.extent,n=this.metadata_.resolutions[this.metadata_.resolutions.length-1];return[t*n+r[0],r[3]-e*n]}},{key:"getIndicesFromExtent",value:function(t){var e=this.metadata_.resolutions[this.metadata_.resolutions.length-1],r=this.metadata_.extent,n=Math.max(t[0],r[0]),a=Math.min(t[2],r[2]),i=Math.max(t[1],r[1]),o=Math.min(t[3],r[3]);return[Math.floor((n-r[0])/e),Math.floor((r[3]-o)/e),Math.floor((a-r[0])/e),Math.floor((r[3]-i)/e)]}},{key:"getExtentFromIndices",value:function(t,e,r,n){var a=this.metadata_.resolutions[this.metadata_.resolutions.length-1],i=this.metadata_.extent,o=t*a+i[0],s=i[3]-e*a,u=r*a+i[0];return[o,i[3]-n*a,u,s]}},{key:"getUrl",value:function(){return this.url_}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getBandIndex",value:function(){return this.bandIndex_}},{key:"setBandIndex",value:function(t){t!==this.bandIndex_&&t>=0&&t<this.bandIndices_.length&&(this.bandIndex_=t,this.set("bands",this.bandIndices_),this.refresh())}},{key:"getTimeIndex",value:function(){return this.currentTimeIndex_}},{key:"setTimeIndex",value:function(t){t!==this.currentTimeIndex_&&t>=0&&t<this.timestamps_.length&&(this.currentTimeIndex_=t,this.set("time",this.timestamps_[this.currentTimeIndex_]),this.refresh())}},{key:"setCurrentTime",value:function(t){var e=this._findClosestTimestampIndex(t);this.setTimeIndex(e)}},{key:"getTimestamps",value:function(){return this.timestamps_}},{key:"getTimeAtIndex",value:function(t){return this.timestamps_[t]||null}},{key:"getIndexAtTime",value:function(t){return this._findClosestTimestampIndex(t)}},{key:"getCurrentTimeIndex",value:function(){return this.currentTimeIndex_}}],i=[{key:"_generateFullArrays",value:function(t,e){var r=Math.max.apply(Math,f(e)),n=Math.min.apply(Math,f(e)),a=new Array(r+1);e.forEach(function(e,r){a[e]=t[r]});for(var i=0;i<=r;i++)if(void 0===a[i])if(i<n)a[i]=t[0]+.001*(n-i);else{for(var o=-1,s=0;s<e.length;s++)if(e[s]>i){o=s;break}if(-1===o)a[i]=t[t.length-1];else{var u=o-1;if(u>=0){var c=e[u],l=(i-c)/(e[o]-c),m=t[u]+(t[o]-t[u])*l;a[i]=m+.001*(i-c)}else a[i]=t[o]}}return a[0]=a[0]+.5,a}}],a&&p(n.prototype,a),i&&p(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,a,i,l,m,h}(a());t=r.hmd(t);const x=g;t.exports&&(t.exports=g,t.exports.ZarrTile=g,t.exports.default=g)}},e={};function r(n){var a=e[n];if(void 0!==a)return a.exports;var i=e[n]={id:n,loaded:!1,exports:{}};return t[n](i,i.exports,r),i.loaded=!0,i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.p="";var n=r(488);module.exports=n})();